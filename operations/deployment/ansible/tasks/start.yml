- name: Log variables app_install_root
  block:
    - debug:
        var: app_install_root

- name: Log variables ECR_URL
  block:
    - debug:
        var: ECR_URL

- name: DEBUG ENV
  debug:
    msg: "VARS: echo $(env)"

- name: DEBUG ENV
  debug:
    msg: "VARS: echo env"

- name: Log All Variables env
  command: "env"

- name: Log All Variables printenv
  command: "printenv"
  
- name: "Log data_mount_target"
  debug:
    msg: "Logging value of data_mount_target: {{ data_mount_target }}"

- name: Display message before installing AWS CLI
  debug:
    msg: "Installing AWS CLI"

- name: Install AWS CLI
  apt:
    name: awscli
    state: present

- name: Display message after installing AWS CLI
  debug:
    msg: "AWS CLI installed successfully"

- name: Display message before configuring AWS CLI
  debug:
    msg: "Configuring AWS CLI"

- name: Log variables ECR_URL
  block:
    - debug:
        var: ECR_URL

- name: Log variables ecr_url
  block:
    - debug:
        var: ecr_url

- name: Configure AWS CLI
  command: "aws configure set region us-east-1 && aws configure set aws_access_key_id {{ aws_access_key_id }} && aws configure set aws_secret_access_key {{ aws_secret_access_key }}"

- name: Display message after configuring AWS CLI
  debug:
    msg: "AWS CLI configured successfully"

- name: Display message before logging in to ECR
  debug:
    msg: "Logging in to ECR"

- name: Log in to ECR
  shell: "aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin {{ ecr_url }}"

- name: Display message after logging in to ECR
  debug:
    msg: "Logged in to ECR successfully"

- name: Start docker-compose
  docker_compose:
    project_src: "{{ app_install_root }}/{{ app_repo_name }}"
    restarted: true
    build: yes
    recreate: always
    nocache: yes
  register: output

- ansible.builtin.debug:
    var: output
